stages:
  - validate

validate_logstash:
  image: docker.elastic.co/logstash/logstash:8.13.0
  stage: validate
  script:
    - echo "ğŸ” Validando sintaxe dos arquivos .conf do Logstash..."
    - |
      for file in $(ls logstash/*.conf); do
        echo "ğŸ“ Verificando: $file"
        if logstash --config.test_and_exit -f "$file"; then
          echo "âœ… $file estÃ¡ vÃ¡lido."
        else
          echo "âŒ ERRO: Sintaxe invÃ¡lida no arquivo: $file"
          exit 1
        fi
      done
  only:
    - merge_requests
    - develop


validate_python:
  image: python:3.10
  stage: validate
  script:
    - pip install flake8 black
    - echo "ğŸ” Validando com flake8 (estrutura e erros bÃ¡sicos)..."
    - flake8 python_scripts/
    - echo "ğŸ¨ Verificando formataÃ§Ã£o com black (modo check)..."
    - black --check python_scripts/